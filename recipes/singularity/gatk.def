Bootstrap: docker
From: 4geniac/almalinux:8.6_conda-py39_4.12.0

%labels
    gitUrl ssh://git@gitlab.curie.fr:2222/data-analysis/vegan.git
    gitCommit d3d8e0d96b2f12197ea3986bc66f6b5941fbd642 / devel

%environment
    export R_LIBS_USER="-"
    export R_PROFILE_USER="-"
    export R_ENVIRON_USER="-"
    export PYTHONNOUSERSITE=1
    export PATH=$PATH
    export LC_ALL=en_US.utf-8
    export LANG=en_US.utf-8
    source /opt/etc/bashrc


# real path from projectDir: gatk.yml
%files
    gatk.yml /opt/gatk.yml

%post
    dnf clean all \
    && conda env create -f /opt/gatk.yml \
    && mkdir -p /opt/etc \
    && echo -e "#! /bin/bash\n\n# script to activate the conda environment gatk-4.1.9.0" > ~/.bashrc \
    && conda init bash \
    && echo "conda activate gatk-4.1.9.0" >> ~/.bashrc \
    && cp ~/.bashrc /opt/etc/bashrc \
    && conda clean -a 

