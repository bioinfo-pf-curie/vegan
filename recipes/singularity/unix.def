Bootstrap: docker
From: 4geniac/almalinux:8.4_conda-py39_4.10.3

%labels
    gitUrl ssh://git@gitlab.curie.fr:2222/data-analysis/vegan
    gitCommit f4091ad181abe539d9437e5ff1cb6e64920fd6af / devel

%environment
    export R_LIBS_USER="-"
    export R_PROFILE_USER="-"
    export R_ENVIRON_USER="-"
    export PYTHONNOUSERSITE=1
    export PATH=$PATH
    export LC_ALL=en_US.utf-8
    export LANG=en_US.utf-8
    source /opt/etc/bashrc


# real path from projectDir: unix.yml
%files
    unix.yml /opt/unix.yml

%post
    dnf clean all \
    && conda env create -f /opt/unix.yml \
    && mkdir -p /opt/etc \
    && echo -e "#! /bin/bash\n\n# script to activate the conda environment unix" > ~/.bashrc \
    && conda init bash \
    && echo "conda activate unix" >> ~/.bashrc \
    && cp ~/.bashrc /opt/etc/bashrc \
    && conda clean -a 

